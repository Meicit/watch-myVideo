<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≤ng Quay May M·∫Øn Premium</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --primary: #e63946; 
            --secondary: #457b9d; 
            --success: #2a9d8f; 
            --dark: #1d3557;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            text-align: center; 
            background: radial-gradient(circle, var(--dark) 0%, #000 100%); 
            color: #fff; 
            margin: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden;
        }

        .container { 
            width: 95%; 
            max-width: 900px; 
            background: rgba(255, 255, 255, 0.98); 
            padding: 50px; 
            border-radius: 50px; 
            box-shadow: 0 0 100px rgba(230, 57, 70, 0.4); 
            color: #333;
        }

        h1 { 
            font-size: 4rem; 
            color: var(--primary); 
            margin: 0 0 30px 0; 
            text-transform: uppercase; 
            letter-spacing: 5px;
            text-shadow: 2px 2px 0px #ddd;
        }
        
        /* Khung hi·ªÉn th·ªã gi·∫£i th∆∞·ªüng kh·ªïng l·ªì */
        .prize-display { 
            font-size: 10rem; 
            font-weight: 900; 
            margin: 40px 0; 
            height: 250px; 
            line-height: 250px;
            color: var(--secondary); 
            background: #f1f3f5; 
            border: 12px solid #dee2e6; 
            border-radius: 40px;
            transition: all 0.3s;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.1);
        }

        /* N√∫t quay si√™u to */
        button { 
            padding: 30px 100px; 
            font-size: 3rem; 
            font-weight: bold; 
            cursor: pointer; 
            background-color: var(--success); 
            color: white; 
            border: none; 
            border-radius: 100px; 
            transition: all 0.1s; 
            box-shadow: 0 15px 0 #1b665d; 
            outline: none;
            text-transform: uppercase;
        }

        button:active { 
            transform: translateY(10px); 
            box-shadow: 0 5px 0 #1b665d; 
        }

        button:disabled { 
            background-color: #bdc3c7; 
            box-shadow: 0 8px 0 #7f8c8d; 
            transform: translateY(5px); 
        }

        .info-panel { 
            display: flex; 
            justify-content: center; 
            gap: 60px; 
            margin-top: 50px; 
            font-size: 2rem; 
            font-weight: bold;
            border-top: 3px solid #eee;
            padding-top: 30px;
        }

        .count-item span { 
            color: var(--primary); 
            font-size: 2.5rem; 
        }
        
        /* Ch·ªâ b√°o ·∫©n (R·∫•t m·ªù ƒë·ªÉ tr√°nh b·ªã l·ªô) */
        #mode-indicator { 
            position: fixed; 
            top: 15px; 
            right: 20px; 
            font-size: 12px; 
            color: rgba(255, 255, 255, 0.03); 
            user-select: none;
        }
    </style>
</head>
<body>

<div id="mode-indicator">Normal</div>

<div class="container">
    <h1>üéä LUCKY DRAW üéä</h1>
    
    <div class="prize-display" id="result">READY</div>
    
    <button id="spinBtn" onclick="spin()">QUAY (Space)</button>

    <div class="info-panel">
        <div class="count-item">Gi·∫£i 50k: <span id="count50">5</span></div>
        <div class="count-item">Gi·∫£i 20k: <span id="count20">10</span></div>
    </div>
</div>

<audio id="tickSound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>
<audio id="winSound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>

<script>
    // C·∫§U H√åNH BAN ƒê·∫¶U
    let inventory = { "50.000": 5, "20.000": 10, "10.000": Infinity };
    let isSpinning = false;
    let cheatMode = false; 

    // 1. X·ª¨ L√ù PH√çM T·∫ÆT
    window.addEventListener('keydown', (e) => {
        // Ph√≠m Space ƒë·ªÉ quay
        if (e.code === "Space" && !isSpinning) {
            spin();
        }
        
        // Ph√≠m Alt Ph·∫£i (Right Alt) ƒë·ªÉ k√≠ch ho·∫°t gi·∫£i 50k
        if (e.code === "AltRight" || e.key === "AltGraph") { 
            cheatMode = true; 
            document.getElementById('mode-indicator').innerText = "Target: 50K";
            e.preventDefault();
        }

        // Ph√≠m 'C' ƒë·ªÉ quay v·ªÅ b√¨nh th∆∞·ªùng n·∫øu b·∫•m nh·∫ßm
        if (e.key.toLowerCase() === "c") { 
            cheatMode = false; 
            document.getElementById('mode-indicator').innerText = "Normal"; 
        }
    });

    function spin() {
        if (isSpinning) return;
        
        const btn = document.getElementById('spinBtn');
        const resultDiv = document.getElementById('result');
        const tick = document.getElementById('tickSound');
        
        isSpinning = true;
        btn.disabled = true;
        resultDiv.style.color = "#457b9d";

        let counter = 0;
        let totalSpins = 150; // Th·ªùi gian quay l√¢u h∆°n (~4.5 gi√¢y)

        const interval = setInterval(() => {
            // Hi·ªáu ·ª©ng nh·∫£y s·ªë ng·∫´u nhi√™n c·ª±c nhanh
            const temp = ["10k", "20k", "50k", "XXk", "??k", "99k"];
            resultDiv.innerText = temp[Math.floor(Math.random() * temp.length)];
            
            // √Çm thanh m·ªói l·∫ßn nh·∫£y s·ªë
            tick.volume = 0.2;
            tick.currentTime = 0;
            tick.play();

            counter++;
            if (counter > totalSpins) {
                clearInterval(interval);
                finalizeResult();
            }
        }, 30); // 30ms = T·ªëc ƒë·ªô nh·∫£y s·ªë c·ª±c nhanh
    }

    function finalizeResult() {
        const btn = document.getElementById('spinBtn');
        const resultDiv = document.getElementById('result');
        const winSound = document.getElementById('winSound');
        
        let finalPrize = "";

        // 2. LOGIC QUAY S·ªê & CH·∫æ ƒê·ªò ·∫®N
        if (cheatMode && inventory["50.000"] > 0) {
            finalPrize = "50.000";
            // T·ª∞ ƒê·ªòNG RESET V·ªÄ B√åNH TH∆Ø·ªúNG SAU KHI D√ôNG
            cheatMode = false; 
            document.getElementById('mode-indicator').innerText = "Normal";
        } else {
            let pool = [];
            // Th√™m c√°c gi·∫£i c√≤n l·∫°i v√†o danh s√°ch l·ª±a ch·ªçn
            if (inventory["50.000"] > 0) pool.push("50.000");
            if (inventory["20.000"] > 0) pool.push("20.000");
            
            // TƒÉng t·ªâ l·ªá gi·∫£i 10k (xu·∫•t hi·ªán 15 l·∫ßn trong pool)
            for(let i=0; i<15; i++) pool.push("10.000"); 

            finalPrize = pool[Math.floor(Math.random() * pool.length)];
        }

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng trong kho
        if (inventory[finalPrize] !== Infinity) {
            inventory[finalPrize]--;
        }

        // 3. HI·ªÇN TH·ªä K·∫æT QU·∫¢
        resultDiv.innerText = finalPrize + "ƒë";
        resultDiv.style.color = "#e63946";
        
        // Ph√°t √¢m thanh th·∫Øng gi·∫£i
        winSound.play();

        // 4. HI·ªÜU ·ª®NG PH√ÅO HOA
        if (finalPrize === "50.000") {
            // Ph√°o hoa t∆∞ng b·ª´ng cho gi·∫£i l·ªõn nh·∫•t
            var duration = 4 * 1000;
            var end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 10, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff0000', '#ffd700', '#ffffff'] });
                confetti({ particleCount: 10, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ff0000', '#ffd700', '#ffffff'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        } else {
            // Ph√°o hoa nh·∫π cho c√°c gi·∫£i kh√°c
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
        }

        updateUI();
        isSpinning = false;
        btn.disabled = false;
    }

    function updateUI() {
        document.getElementById('count50').innerText = inventory["50.000"];
        document.getElementById('count20').innerText = inventory["20.000"];
    }
</script>

</body>
</html>
