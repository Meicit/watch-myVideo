<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360¬∞ Video Player - GitHub Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://p2p.xyz/js/panolens.min.js"></script>
    
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background-color: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        #container { width: 100%; height: 100vh; }

        /* B·∫£ng ƒëi·ªÅu khi·ªÉn ph√≠a tr√™n */
        #gui-controls {
            position: absolute; top: 20px; left: 50%;
            transform: translateX(-50%); z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px; border-radius: 50px;
            display: flex; gap: 15px; align-items: center;
            border: 1px solid #444; color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        input[type="file"] { font-size: 14px; cursor: pointer; }

        select {
            background: #333; color: white; border: none;
            padding: 5px 10px; border-radius: 5px; cursor: pointer;
        }

        /* L·ªõp ph·ªß th√¥ng b√°o/n√∫t b·∫•m */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none;
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 200; color: white; text-align: center;
        }

        .play-btn {
            background: #ff4757; border: none; color: white;
            padding: 15px 40px; font-size: 18px; border-radius: 30px;
            cursor: pointer; font-weight: bold; margin-top: 15px;
            transition: transform 0.2s;
        }

        .play-btn:hover { transform: scale(1.1); background: #ff6b81; }

        .status { font-size: 12px; color: #aaa; margin-top: 10px; }
    </style>
</head>
<body>

<div id="gui-controls">
    <label for="fileInput">üìÅ Ch·ªçn Video:</label>
    <input type="file" id="fileInput" accept="video/mp4,video/x-m4v,video/*">
    <select id="videoType">
        <option value="360">Ch·∫ø ƒë·ªô 360¬∞</option>
        <option value="normal">Ch·∫ø ƒë·ªô Th∆∞·ªùng (Ph·∫≥ng)</option>
    </select>
</div>

<div id="overlay">
    <h2 id="fileNameDisplay">Video ƒë√£ s·∫µn s√†ng</h2>
    <button class="play-btn" id="startBtn">NH·∫§N ƒê·ªÇ XEM</button>
    <p class="status">C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ k√≠ch ho·∫°t √¢m thanh & h√¨nh ·∫£nh</p>
</div>

<div id="container"></div>

<script>
    const container = document.querySelector('#container');
    const fileInput = document.querySelector('#fileInput');
    const videoType = document.querySelector('#videoType');
    const overlay = document.querySelector('#overlay');
    const startBtn = document.querySelector('#startBtn');
    const fileNameDisplay = document.querySelector('#fileNameDisplay');

    let viewer, videoPano;

    // 1. Kh·ªüi t·∫°o Viewer
    viewer = new PANOLENS.Viewer({ 
        container: container,
        autoHideControlBar: false,
        controlBar: true,
    });

    // 2. X·ª≠ l√Ω khi ch·ªçn file
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const url = URL.createObjectURL(file);
        fileNameDisplay.innerText = file.name;
        
        // Hi·ªán l·ªõp ph·ªß y√™u c·∫ßu nh·∫•n Play
        overlay.style.display = 'flex';

        // X√≥a video c≈© n·∫øu ƒëang ch·∫°y
        if (videoPano) {
            viewer.remove(videoPano);
            videoPano.dispose();
        }

        // T·∫°o Panorama Video m·ªõi
        if (videoType.value === '360') {
            videoPano = new PANOLENS.VideoPano(url, { 
                autoplay: false, // S·∫Ω cho play th·ªß c√¥ng qua n√∫t
                muted: false,
                loop: true 
            });
        } else {
            // Video th∆∞·ªùng nh∆∞ng v·∫´n hi·ªÉn th·ªã trong kh√¥ng gian 360 (gi·∫£ l·∫≠p r·∫°p phim)
            videoPano = new PANOLENS.VideoPano(url, { autoplay: false });
        }

        viewer.add(videoPano);
        viewer.setPanorama(videoPano);
    });

    // 3. X·ª≠ l√Ω n√∫t Start (Kh·∫Øc ph·ª•c l·ªói kh√¥ng play)
    startBtn.addEventListener('click', function() {
        if (videoPano) {
            videoPano.play(); // L·ªánh quan tr·ªçng nh·∫•t
            overlay.style.display = 'none';
        }
    });

    // H·ªó tr·ª£ xoay chu·ªôt linh ho·∫°t
    window.addEventListener('resize', function() {
        viewer.onWindowResize();
    });
</script>

</body>
</html>
